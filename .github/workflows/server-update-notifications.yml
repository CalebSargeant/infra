name: Server Update Notifications

on:
  repository_dispatch:
    types: [server-update]
  workflow_dispatch:
    inputs:
      server_name:
        description: 'Server name'
        required: true
        type: string
      status:
        description: 'Update status (success, reboot_required, failed, skipped)'
        required: true
        type: choice
        options:
          - success
          - reboot_required  
          - failed
          - skipped
      message:
        description: 'Update details'
        required: true
        type: string
      uptime:
        description: 'Server uptime'
        required: false
        type: string
      packages_updated:
        description: 'Number of packages updated'
        required: false
        type: string
      error_details:
        description: 'Error details if failed'
        required: false
        type: string

jobs:
  send-notification:
    uses: calebsargeant/reusable-workflows/.github/workflows/server-update-notifications.yml@main
    with:
      server_name: ${{ github.event.inputs.server_name || github.event.client_payload.server_name }}
      status: ${{ github.event.inputs.status || github.event.client_payload.status }}
      message: ${{ github.event.inputs.message || github.event.client_payload.message }}
      uptime: ${{ github.event.inputs.uptime || github.event.client_payload.uptime }}
      packages_updated: ${{ github.event.inputs.packages_updated || github.event.client_payload.packages_updated }}
      error_details: ${{ github.event.inputs.error_details || github.event.client_payload.error_details }}
    secrets:
      SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
      SLACK_ENGINEERING_ALERTS_CHANNEL: ${{ secrets.SLACK_ENGINEERING_ALERTS_CHANNEL }}
      SLACK_ENGINEERING_WARNINGS_CHANNEL: ${{ secrets.SLACK_ENGINEERING_WARNINGS_CHANNEL }}
      SLACK_ENGINEERING_INFO_CHANNEL: ${{ secrets.SLACK_ENGINEERING_INFO_CHANNEL }}
