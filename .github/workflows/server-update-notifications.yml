name: Server Update Notifications

on:
  repository_dispatch:
    types: [server-update]
  workflow_dispatch:
    inputs:
      server_name:
        description: 'Server name'
        required: true
        type: string
      status:
        description: 'Update status (success, reboot_required, failed, skipped)'
        required: true
        type: choice
        options:
          - success
          - reboot_required  
          - failed
          - skipped
      message:
        description: 'Update details'
        required: true
        type: string
      uptime:
        description: 'Server uptime'
        required: false
        type: string
      packages_updated:
        description: 'Number of packages updated'
        required: false
        type: string
      error_details:
        description: 'Error details if failed'
        required: false
        type: string
      enable_reboot_button:
        description: 'Enable interactive reboot button'
        required: false
        type: boolean
        default: false

jobs:
  send-notification:
    uses: calebsargeant/reusable-workflows/.github/workflows/server-update-notifications.yml@main
    with:
      server_name: ${{ github.event.inputs.server_name || github.event.client_payload.server_name }}
      status: ${{ github.event.inputs.status || github.event.client_payload.status }}
      message: ${{ github.event.inputs.message || github.event.client_payload.message }}
      uptime: ${{ github.event.inputs.uptime || github.event.client_payload.uptime }}
      packages_updated: ${{ github.event.inputs.packages_updated || github.event.client_payload.packages_updated }}
      error_details: ${{ github.event.inputs.error_details || github.event.client_payload.error_details }}
      enable_reboot_button: ${{ github.event.inputs.enable_reboot_button == 'true' || github.event.client_payload.enable_reboot_button == true }}
    secrets:
      SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
      SLACK_CHANNEL_ID: ${{ secrets.SLACK_CHANNEL_ID }}
