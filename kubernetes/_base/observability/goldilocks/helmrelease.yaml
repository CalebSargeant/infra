apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
  name: goldilocks
  namespace: observability
  labels:
    app.kubernetes.io/name: goldilocks
spec:
  interval: 1h
  chart:
    spec:
      chart: goldilocks
      version: "8.0.2"
      sourceRef:
        kind: HelmRepository
        name: fairwinds-stable
        namespace: flux-system
      interval: 1h
  install:
    createNamespace: true
  upgrade: {}
  values:
    # Dashboard - web UI for viewing recommendations
    dashboard:
      enabled: true
      replicaCount: 1
      service:
        type: ClusterIP
        port: 80
      resources:
        requests:
          cpu: 25m
          memory: 64Mi
        limits:
          cpu: 100m
          memory: 256Mi
      # Ingress configuration (disabled by default - using separate ingress.yaml instead)
      ingress:
        enabled: false
        # To enable ingress, uncomment and configure:
        # ingressClassName: nginx
        # hosts:
        #   - host: goldilocks.example.com
        #     paths:
        #       - path: /
        #         type: ImplementationSpecific
    
    # Controller - creates VPA objects for namespaces
    controller:
      enabled: true
      resources:
        requests:
          cpu: 25m
          memory: 64Mi
        limits:
          cpu: 100m
          memory: 256Mi
      # Flags for controller behavior
      flags:
        # Only create VPAs in namespaces with the goldilocks.fairwinds.com/enabled=true label
        on-by-default: false
