apiVersion: v1
kind: ConfigMap
metadata:
  name: headlamp-values
  namespace: misc
data:
  values.yaml: |
    # Configuration - keep in-cluster for firefly, add external via KUBECONFIG
    config:
      baseURL: ""
      inCluster: true
      
    # Point to kubeconfig file for additional clusters
    env:
      - name: KUBECONFIG
        value: "/home/headlamp/.config/Headlamp/kubeconfigs/p1-staging-eks"
    
    ingress:
      enabled: true
      annotations:
        # TLS certificate
        cert-manager.io/cluster-issuer: letsencrypt-dns
        # Basic auth for access control
        nginx.ingress.kubernetes.io/auth-type: basic
        nginx.ingress.kubernetes.io/auth-secret: headlamp-basic-auth
        nginx.ingress.kubernetes.io/auth-realm: 'Authentication Required - Headlamp'
      hosts:
        - host: headlamp.sargeant.co
          paths:
            - path: /
              type: ImplementationSpecific
      tls:
        - secretName: headlamp-tls
          hosts:
            - headlamp.sargeant.co
    
    # Run on Pi nodes
    nodeSelector:
      type: pi
    
    # Minimal resources
    resources:
      requests:
        cpu: 50m
        memory: 64Mi
      limits:
        cpu: 200m
        memory: 128Mi
    
    # Mount kubeconfig directory (one file per cluster) and AWS credentials
    volumeMounts:
      - name: external-kubeconfigs
        mountPath: /home/headlamp/.config/Headlamp/kubeconfigs
        readOnly: true
      - name: aws-credentials
        mountPath: /home/headlamp/.aws
        readOnly: true
    
    volumes:
      - name: external-kubeconfigs
        secret:
          secretName: headlamp-kubeconfigs
      - name: aws-credentials
        secret:
          secretName: headlamp-aws-credentials
          items:
            - key: credentials
              path: credentials
